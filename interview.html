<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HiveMinds - Interview Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --dark-color: #1f2937;
            --light-color: #f9fafb;
            --percentage: 0%;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
        }
        
        .interview-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            height: 100vh;
        }
        
        .video-container {
            position: relative;
            background-color: #000;
            border-radius: 8px;
            overflow: hidden;
            height: 70vh;
        }
        
        .video-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #e5e7eb;
            color: #6b7280;
        }
        
        .video-controls {
            position: absolute;
            bottom: 10px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 15px;
            z-index: 10;
        }
        
        .control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .control-btn:hover {
            background-color: var(--primary-color);
            transform: scale(1.1);
        }
        
        .hand-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            display: none;
        }
        
        .chat-container {
            height: 30vh;
            display: flex;
            flex-direction: column;
            border-top: 1px solid #e5e7eb;
        }
        
        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            background-color: #f9fafb;
        }
        
        .message {
            margin-bottom: 15px;
            max-width: 80%;
            font-size: 14px;
        }
        
        .message-interviewer {
            align-self: flex-start;
            background-color: #e5e7eb;
            border-radius: 0 10px 10px 10px;
            padding: 8px 12px;
        }
        
        .message-candidate {
            align-self: flex-end;
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 0 10px 10px;
            padding: 8px 12px;
        }
        
        .message-system {
            align-self: center;
            background-color: #f0f0f0;
            border-radius: 10px;
            padding: 5px 10px;
            font-size: 12px;
            color: #666;
            text-align: center;
            max-width: 90%;
        }
        
        .chat-input {
            display: flex;
            gap: 10px;
            padding: 10px;
            background-color: white;
            border-top: 1px solid #e5e7eb;
        }
        
        .toolbar {
            background-color: white;
            padding: 15px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .feature-btn {
            background-color: transparent;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .feature-btn:hover {
            background-color: #f3f4f6;
            border-color: #d1d5db;
        }
        
        .timer {
            font-family: monospace;
            font-size: 18px;
            color: var(--dark-color);
        }
        
        .sidebar {
            background-color: white;
            border-right: 1px solid #e5e7eb;
            height: 100%;
            width: 180px;
        }
        
        .sidebar-item {
            padding: 10px 12px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .sidebar-item:hover {
            background-color: #f9fafb;
        }
        
        .sidebar-item.active {
            background-color: #eff6ff;
            border-left: 3px solid var(--primary-color);
        }
        
        .hand-raised {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .recording-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #dc2626;
            font-weight: 500;
            font-size: 14px;
        }
        
        .recording-dot {
            width: 10px;
            height: 10px;
            background-color: #dc2626;
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }
        
        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }
        
        .candidate-video-pip {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 150px;
            background-color: #000;
            border-radius: 8px;
            overflow: hidden;
            z-index: 10;
            border: 2px solid white;
        }
        
        .reaction-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #f3f4f6;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .reaction-btn:hover {
            background-color: #e5e7eb;
            transform: scale(1.1);
        }
        
        .reaction-menu {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 30px;
            padding: 5px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 20;
        }
        
        .settings-menu {
            position: absolute;
            top: 50px;
            right: 0;
            background: white;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 200px;
            display: none;
            z-index: 100;
        }
        
        .settings-item {
            padding: 8px 10px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .settings-item:hover {
            background-color: #f3f4f6;
        }
        
        .screen-share-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 5;
            display: none;
        }
        
        .reaction-display {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 40px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: reactionRise 3s forwards;
            z-index: 15;
        }
        
        @keyframes reactionRise {
            0% {
                transform: translateX(-50%) translateY(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateX(-50%) translateY(-100px);
                opacity: 0;
            }
        }
        
        /* Results Screen */
        .results-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 1000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            text-align: center;
        }
        
        .score-circle {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: conic-gradient(var(--primary-color) 0% var(--percentage), #e5e7eb var(--percentage) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 30px 0;
            position: relative;
            transition: --percentage 1.5s ease-out;
        }
        
        .score-inner {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background-color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }
        
        .score-percent {
            font-size: 36px;
            color: var(--dark-color);
            line-height: 1;
        }
        
        .score-label {
            font-size: 14px;
            color: #6b7280;
            margin-top: 5px;
        }
        
        .feedback-item {
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            background-color: #f8f9fa;
            width: 100%;
            max-width: 600px;
            text-align: left;
        }
        
        .feedback-category {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--dark-color);
            display: flex;
            justify-content: space-between;
        }
        
        .feedback-score {
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .results-nav {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        /* Responsive adjustments */
        @media (max-width: 992px) {
            .sidebar {
                width: 60px;
                overflow: hidden;
            }
            
            .sidebar-item span {
                display: none;
            }
            
            .sidebar-item {
                text-align: center;
            }
            
            .sidebar-item i {
                margin-right: 0;
            }
            
            .feature-btn span {
                display: none;
            }
            
            .feature-btn i {
                margin-right: 0;
            }
            
            .timer {
                font-size: 14px;
            }
            
            .score-circle {
                width: 150px;
                height: 150px;
            }
            
            .score-inner {
                width: 120px;
                height: 120px;
            }
            
            .score-percent {
                font-size: 32px;
            }
        }
        
        @media (max-width: 768px) {
            .video-container {
                height: 60vh;
            }
            
            .chat-container {
                height: 40vh;
            }
            
            .candidate-video-pip {
                width: 120px;
                height: 90px;
            }
            
            .toolbar {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .score-circle {
                width: 130px;
                height: 130px;
            }
            
            .score-inner {
                width: 100px;
                height: 100px;
            }
            
            .score-percent {
                font-size: 28px;
            }
            
            .results-nav {
                flex-direction: column;
                width: 100%;
                max-width: 300px;
            }
            
            .results-nav .btn {
                width: 100%;
            }
        }
        
        @media (max-width: 576px) {
            .video-container {
                height: 50vh;
            }
            
            .chat-container {
                height: 50vh;
            }
            
            .control-btn {
                width: 32px;
                height: 32px;
                font-size: 12px;
            }
            
            .feature-btn {
                padding: 6px 8px;
            }
            
            .score-circle {
                width: 120px;
                height: 120px;
            }
            
            .score-inner {
                width: 90px;
                height: 90px;
            }
            
            .score-percent {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid p-0 h-100">
        <div class="interview-container h-100">
            <!-- Toolbar -->
            <div class="toolbar">
                <div>
                    <h4 class="mb-0">Interview Session</h4>
                    <small class="text-muted">Position: Senior Software Engineer</small>
                </div>
                <div class="d-flex align-items-center gap-3">
                    <div class="timer" id="interviewTimer">00:00:00</div>
                    <div class="recording-indicator" id="recordingIndicator" style="display: none;">
                        <div class="recording-dot"></div>
                        <span>Recording</span>
                    </div>
                    <div class="position-relative">
                        <button class="feature-btn" id="settingsBtn">
                            <i class="fas fa-cog"></i>
                            <span class="d-none d-lg-inline">Settings</span>
                        </button>
                        <div class="settings-menu" id="settingsMenu">
                            <div class="settings-item" id="recordOption">
                                <i class="fas fa-circle me-2"></i> <span>Start Recording</span>
                            </div>
                            <div class="settings-item" id="muteOption">
                                <i class="fas fa-microphone me-2"></i> <span>Mute Microphone</span>
                            </div>
                            <div class="settings-item" id="videoOption">
                                <i class="fas fa-video me-2"></i> <span>Turn Off Video</span>
                            </div>
                            <div class="settings-item" id="reactionOption">
                                <i class="fas fa-smile me-2"></i> <span>Send Reaction</span>
                            </div>
                        </div>
                    </div>
                    <button class="feature-btn" id="screenShareBtn">
                        <i class="fas fa-share-square"></i>
                        <span class="d-none d-lg-inline">Share Screen</span>
                    </button>
                </div>
            </div>
            
            <div class="row g-0 h-100">
                <!-- Sidebar -->
                <div class="sidebar">
                    <div class="sidebar-item active">
                        <i class="fas fa-video me-2"></i>
                        <span>Video</span>
                    </div>
                    <div class="sidebar-item">
                        <i class="fas fa-file-alt me-2"></i>
                        <span>Resume</span>
                    </div>
                    <div class="sidebar-item">
                        <i class="fas fa-clipboard-list me-2"></i>
                        <span>Evaluation</span>
                    </div>
                    <div class="sidebar-item">
                        <i class="fas fa-sticky-note me-2"></i>
                        <span>Notes</span>
                    </div>
                    <div class="sidebar-item">
                        <i class="fas fa-chart-bar me-2"></i>
                        <span>Analytics</span>
                    </div>
                    <div class="sidebar-item">
                        <i class="fas fa-question-circle me-2"></i>
                        <span>Help</span>
                    </div>
                </div>
                
                <!-- Main Content -->
                <div class="col d-flex flex-column h-100">
                    <div class="video-container">
                        <!-- Screen Share Container -->
                        <div class="screen-share-container" id="screenShareContainer">
                            <div class="video-placeholder">
                                <i class="fas fa-desktop fa-3x mb-3"></i>
                                <p>Screen Sharing</p>
                            </div>
                            <video id="screenShareVideo" autoplay style="width: 100%; height: 100%; display: none;"></video>
                            <div class="video-controls">
                                <button class="control-btn" id="stopScreenShareBtn">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Interviewer Video -->
                        <div class="video-placeholder" id="interviewerVideoPlaceholder">
                            <div class="text-center">
                                <i class="fas fa-user-tie fa-3x mb-3"></i>
                                <p>AI Interviewer</p>
                                <button class="btn btn-primary btn-sm" id="startInterviewBtn">
                                    <i class="fas fa-play me-1"></i> Start Interview
                                </button>
                            </div>
                        </div>
                        <video id="interviewerVideo" style="width: 100%; height: 100%; display: none;" controls></video>
                        
                        <!-- Candidate Video PIP -->
                        <div class="candidate-video-pip">
                            <div class="video-placeholder" id="candidateVideoPlaceholder">
                                <div class="text-center">
                                    <i class="fas fa-user fa-3x mb-3"></i>
                                </div>
                            </div>
                            <video id="candidateVideo" autoplay muted style="width: 100%; height: 100%; display: none;"></video>
                            <div class="hand-indicator" id="handIndicator">
                                <i class="fas fa-hand-paper me-1"></i> <span id="handSide">Right</span> hand raised
                            </div>
                            <div class="video-controls" id="candidateControls" style="display: none;">
                                <button class="control-btn" id="raiseHandBtn">
                                    <i class="fas fa-hand-paper"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Reaction Menu -->
                        <div class="reaction-menu" id="reactionMenu">
                            <button class="reaction-btn" data-reaction="👍">👍</button>
                            <button class="reaction-btn" data-reaction="👎">👎</button>
                            <button class="reaction-btn" data-reaction="😊">😊</button>
                            <button class="reaction-btn" data-reaction="🤔">🤔</button>
                            <button class="reaction-btn" data-reaction="👏">👏</button>
                        </div>
                    </div>
                    
                    <!-- Chat Section -->
                    <div class="chat-container">
                        <div class="chat-messages" id="chatMessages">
                            <!-- Messages will appear here -->
                        </div>
                        
                        <div class="chat-input">
                            <input type="text" class="form-control form-control-sm" id="messageInput" placeholder="Type your answer here...">
                            <button class="btn btn-primary btn-sm" id="sendMessageBtn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" id="voiceInputBtn">
                                <i class="fas fa-microphone"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Results Screen -->
        <div class="results-screen" id="resultsScreen">
            <h2>Interview Completed</h2>
            <p>Thank you for participating in the interview. Here are your results:</p>
            
            <div class="score-circle" id="scoreCircle">
                <div class="score-inner">
                    <div class="score-percent" id="scorePercent">0%</div>
                    <div class="score-label">Overall Score</div>
                </div>
            </div>
            
            <div class="feedback-item">
                <div class="feedback-category">
                    <span>Technical Knowledge</span>
                    <span class="feedback-score" id="techScore">0%</span>
                </div>
                <div>Demonstrated strong understanding of core concepts but could improve on some advanced topics.</div>
            </div>
            
            <div class="feedback-item">
                <div class="feedback-category">
                    <span>Problem Solving</span>
                    <span class="feedback-score" id="problemScore">0%</span>
                </div>
                <div>Showed good analytical skills and logical approach to challenges.</div>
            </div>
            
            <div class="feedback-item">
                <div class="feedback-category">
                    <span>Communication</span>
                    <span class="feedback-score" id="commScore">0%</span>
                </div>
                <div>Clear and articulate responses, though could benefit from more structured explanations.</div>
            </div>
            
            <div class="results-nav">
                <button class="btn btn-outline-secondary" id="reviewInterviewBtn">
                    <i class="fas fa-undo me-2"></i> Review Interview
                </button>
                <button class="btn btn-primary" id="returnToDashboardBtn">
                    <i class="fas fa-home me-2"></i> Return to Dashboard
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // DOM Elements
        const startInterviewBtn = document.getElementById('startInterviewBtn');
        const interviewerVideoPlaceholder = document.getElementById('interviewerVideoPlaceholder');
        const interviewerVideo = document.getElementById('interviewerVideo');
        const candidateVideoPlaceholder = document.getElementById('candidateVideoPlaceholder');
        const candidateVideo = document.getElementById('candidateVideo');
        const candidateControls = document.getElementById('candidateControls');
        const handIndicator = document.getElementById('handIndicator');
        const handSide = document.getElementById('handSide');
        const raiseHandBtn = document.getElementById('raiseHandBtn');
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendMessageBtn = document.getElementById('sendMessageBtn');
        const voiceInputBtn = document.getElementById('voiceInputBtn');
        const interviewTimer = document.getElementById('interviewTimer');
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsMenu = document.getElementById('settingsMenu');
        const recordOption = document.getElementById('recordOption');
        const muteOption = document.getElementById('muteOption');
        const videoOption = document.getElementById('videoOption');
        const reactionOption = document.getElementById('reactionOption');
        const recordingIndicator = document.getElementById('recordingIndicator');
        const screenShareBtn = document.getElementById('screenShareBtn');
        const screenShareContainer = document.getElementById('screenShareContainer');
        const screenShareVideo = document.getElementById('screenShareVideo');
        const stopScreenShareBtn = document.getElementById('stopScreenShareBtn');
        const reactionMenu = document.getElementById('reactionMenu');
        const resultsScreen = document.getElementById('resultsScreen');
        const scoreCircle = document.getElementById('scoreCircle');
        const scorePercent = document.getElementById('scorePercent');
        const techScore = document.getElementById('techScore');
        const problemScore = document.getElementById('problemScore');
        const commScore = document.getElementById('commScore');
        const reviewInterviewBtn = document.getElementById('reviewInterviewBtn');
        const returnToDashboardBtn = document.getElementById('returnToDashboardBtn');
        
        // Variables
        let isInterviewStarted = false;
        let isHandRaised = false;
        let isRecording = false;
        let isMuted = false;
        let isVideoOff = false;
        let isScreenSharing = false;
        let seconds = 0, minutes = 0, hours = 0;
        let timerInterval;
        let answeredQuestions = 0;
        let interviewResponses = [];
        
        // Interview Questions
        const interviewQuestions = [
            "Can you tell us about yourself and your professional background?",
            "What interests you about this position and our company?",
            "Describe a challenging project you worked on and how you handled it.",
            "How do you prioritize your work when you have multiple deadlines?",
            "Tell us about a time you had a conflict with a team member and how you resolved it.",
            "What programming languages/technologies are you most proficient in?",
            "How do you stay updated with the latest developments in your field?",
            "Describe your approach to debugging complex issues.",
            "Where do you see yourself in 5 years?",
            "Do you have any questions for us about the role or company?"
        ];
        
        // Sample AI Interviewer Video (placeholder for actual implementation)
        const interviewerVideoSrc = "que.mp4";
        
        // Start Interview
        startInterviewBtn.addEventListener('click', function() {
            if (!isInterviewStarted) {
                // Show interviewer video
                interviewerVideoPlaceholder.style.display = 'none';
                interviewerVideo.src = interviewerVideoSrc;
                interviewerVideo.style.display = 'block';
                interviewerVideo.play();
                
                // Start candidate camera
                startCandidateCamera();
                
                // Start timer
                startTimer();
                
                isInterviewStarted = true;
                startInterviewBtn.innerHTML = '<i class="fas fa-sync-alt me-1"></i> Restart Interview';
                
                // Add welcome message and first question
                addChatMessage('interviewer', 'Welcome to your interview. Let\'s begin with the first question.');
                setTimeout(() => {
                    addChatMessage('interviewer', interviewQuestions[0]);
                }, 1500);
            } else {
                // Restart interview
                interviewerVideo.currentTime = 0;
                interviewerVideo.play();
                seconds = 0; minutes = 0; hours = 0;
                updateTimerDisplay();
                chatMessages.innerHTML = '';
                answeredQuestions = 0;
                interviewResponses = [];
                addChatMessage('interviewer', 'Interview restarted. Let\'s begin again.');
                setTimeout(() => {
                    addChatMessage('interviewer', interviewQuestions[0]);
                }, 1500);
            }
        });
        
        // Start Candidate Camera
        function startCandidateCamera() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ 
                    video: true, 
                    audio: true 
                }).then(function(stream) {
                    candidateVideoPlaceholder.style.display = 'none';
                    candidateVideo.srcObject = stream;
                    candidateVideo.style.display = 'block';
                    candidateControls.style.display = 'flex';
                }).catch(function(error) {
                    console.error("Error accessing camera: ", error);
                    candidateVideoPlaceholder.innerHTML = `
                        <div class="text-center text-danger">
                            <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                            <p>Camera access denied</p>
                        </div>
                    `;
                });
            }
        }
        
        // Raise Hand Button
        raiseHandBtn.addEventListener('click', function() {
            isHandRaised = !isHandRaised;
            
            if (isHandRaised) {
                raiseHandBtn.innerHTML = '<i class="fas fa-hand-paper"></i>';
                raiseHandBtn.classList.add('hand-raised');
                handIndicator.style.display = 'block';
                
                // Randomly show left or right hand for demo
                const isLeft = Math.random() > 0.5;
                handSide.textContent = isLeft ? 'Left' : 'Right';
                
                // Add notification to chat
                addChatMessage('system', `Candidate raised ${isLeft ? 'left' : 'right'} hand`);
            } else {
                raiseHandBtn.innerHTML = '<i class="fas fa-hand-paper"></i>';
                raiseHandBtn.classList.remove('hand-raised');
                handIndicator.style.display = 'none';
            }
        });
        
        // Chat Functions
        sendMessageBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') sendMessage();
        });
        
        function sendMessage() {
            const message = messageInput.value.trim();
            if (message) {
                addChatMessage('candidate', message);
                interviewResponses.push({
                    question: interviewQuestions[answeredQuestions],
                    answer: message
                });
                messageInput.value = '';
                answeredQuestions++;
                
                // Calculate and show results if all questions answered
                if (answeredQuestions >= interviewQuestions.length) {
                    setTimeout(() => {
                        showResults();
                    }, 2000);
                    return;
                }
                
                // Simulate interviewer response after a delay
                setTimeout(() => {
                    addChatMessage('interviewer', interviewQuestions[answeredQuestions]);
                }, 1000);
            }
        }
        
        function addChatMessage(sender, text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${sender}`;
            
            if (sender === 'system') {
                messageDiv.innerHTML = `<i class="fas fa-info-circle me-1"></i> ${text}`;
            } else {
                messageDiv.innerHTML = `<strong>${sender === 'interviewer' ? 'Interviewer' : 'You'}:</strong> ${text}`;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Show results screen
        function showResults() {
            // Stop all media streams
            if (candidateVideo.srcObject) {
                candidateVideo.srcObject.getTracks().forEach(track => track.stop());
            }
            
            // Calculate scores (in a real app, this would be based on actual evaluation)
            const overallScore = Math.floor(Math.random() * 30 + 70); // 70-100%
            const techScoreValue = Math.floor(Math.random() * 20 + 70); // 70-90%
            const problemScoreValue = Math.floor(Math.random() * 25 + 65); // 65-90%
            const commScoreValue = Math.floor(Math.random() * 20 + 75); // 75-95%
            
            // Update the score circle animation
            document.documentElement.style.setProperty('--percentage', `${overallScore}%`);
            
            // Animate the score display
            animateValue(scorePercent, 0, overallScore, 1500);
            animateValue(techScore, 0, techScoreValue, 1500);
            animateValue(problemScore, 0, problemScoreValue, 1500);
            animateValue(commScore, 0, commScoreValue, 1500);
            
            // Show results screen
            resultsScreen.style.display = 'flex';
            
            // Hide main interview interface
            document.querySelector('.interview-container').style.display = 'none';
        }
        
        // Animate value counter
        function animateValue(element, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const value = Math.floor(progress * (end - start) + start);
                element.textContent = value + "%";
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }
        
        // Return to dashboard
        returnToDashboardBtn.addEventListener('click', function() {
            // In a real app, this would redirect to the dashboard
            alert("Redirecting to dashboard...");
            // window.location.href = './dashboard';
        });
        
        // Review interview button
        reviewInterviewBtn.addEventListener('click', function() {
            // Hide results screen
            resultsScreen.style.display = 'none';
            
            // Show main interview interface
            document.querySelector('.interview-container').style.display = 'block';
            
            // Restart the interview
            startInterviewBtn.click();
        });
        
        // Voice Input (placeholder)
        voiceInputBtn.addEventListener('click', function() {
            alert("Voice input would be implemented with the Web Speech API in a production environment");
        });
        
        // Timer Functions
        function startTimer() {
            timerInterval = setInterval(updateTimer, 1000);
        }
        
        function updateTimer() {
            seconds++;
            if (seconds >= 60) {
                seconds = 0;
                minutes++;
                if (minutes >= 60) {
                    minutes = 0;
                    hours++;
                }
            }
            updateTimerDisplay();
        }
        
        function updateTimerDisplay() {
            interviewTimer.textContent = 
                `${hours.toString().padStart(2, '0')}:` +
                `${minutes.toString().padStart(2, '0')}:` +
                `${seconds.toString().padStart(2, '0')}`;
        }
        
        // Settings Menu
        settingsBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            settingsMenu.style.display = settingsMenu.style.display === 'block' ? 'none' : 'block';
        });
        
        // Close settings when clicking elsewhere
        document.addEventListener('click', function() {
            settingsMenu.style.display = 'none';
            reactionMenu.style.display = 'none';
        });
        
        // Record Option
        recordOption.addEventListener('click', function(e) {
            e.stopPropagation();
            isRecording = !isRecording;
            
            if (isRecording) {
                recordOption.innerHTML = '<i class="fas fa-stop me-2"></i> Stop Recording';
                recordingIndicator.style.display = 'flex';
                
                // In a real app, we would use MediaRecorder API here
                alert("Recording started (MediaRecorder API would be used in production)");
            } else {
                recordOption.innerHTML = '<i class="fas fa-circle me-2"></i> Start Recording';
                recordingIndicator.style.display = 'none';
                alert("Recording saved");
            }
            
            settingsMenu.style.display = 'none';
        });
        
        // Mute Option
        muteOption.addEventListener('click', function(e) {
            e.stopPropagation();
            isMuted = !isMuted;
            
            if (isMuted) {
                muteOption.innerHTML = '<i class="fas fa-microphone-slash me-2"></i> Unmute';
                // Mute the candidate's audio
                if (candidateVideo.srcObject) {
                    const audioTracks = candidateVideo.srcObject.getAudioTracks();
                    audioTracks.forEach(track => track.enabled = false);
                }
            } else {
                muteOption.innerHTML = '<i class="fas fa-microphone me-2"></i> Mute';
                // Unmute the candidate's audio
                if (candidateVideo.srcObject) {
                    const audioTracks = candidateVideo.srcObject.getAudioTracks();
                    audioTracks.forEach(track => track.enabled = true);
                }
            }
            
            settingsMenu.style.display = 'none';
        });
        
        // Video Option
        videoOption.addEventListener('click', function(e) {
            e.stopPropagation();
            isVideoOff = !isVideoOff;
            
            if (isVideoOff) {
                videoOption.innerHTML = '<i class="fas fa-video-slash me-2"></i> Turn On Video';
                // Turn off candidate's video
                if (candidateVideo.srcObject) {
                    const videoTracks = candidateVideo.srcObject.getVideoTracks();
                    videoTracks.forEach(track => track.enabled = false);
                }
            } else {
                videoOption.innerHTML = '<i class="fas fa-video me-2"></i> Turn Off Video';
                // Turn on candidate's video
                if (candidateVideo.srcObject) {
                    const videoTracks = candidateVideo.srcObject.getVideoTracks();
                    videoTracks.forEach(track => track.enabled = true);
                }
            }
            
            settingsMenu.style.display = 'none';
        });
        
        // Reaction Option
        reactionOption.addEventListener('click', function(e) {
            e.stopPropagation();
            reactionMenu.style.display = reactionMenu.style.display === 'flex' ? 'none' : 'flex';
            settingsMenu.style.display = 'none';
        });
        
        // Reaction Buttons
        document.querySelectorAll('.reaction-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.stopPropagation();
                const reaction = this.getAttribute('data-reaction');
                showReaction(reaction);
                reactionMenu.style.display = 'none';
            });
        });
        
        // Show reaction animation
        function showReaction(reaction) {
            const reactionElement = document.createElement('div');
            reactionElement.className = 'reaction-display';
            reactionElement.textContent = reaction;
            document.querySelector('.video-container').appendChild(reactionElement);
            
            // Remove after animation completes
            setTimeout(() => {
                reactionElement.remove();
            }, 3000);
        }
        
        // Screen Sharing
        screenShareBtn.addEventListener('click', function() {
            if (!isScreenSharing) {
                // In a real app, we would use getDisplayMedia()
                screenShareContainer.style.display = 'block';
                screenShareBtn.innerHTML = '<i class="fas fa-stop me-1"></i> Stop Sharing';
                isScreenSharing = true;
                
                // Simulate screen sharing (in production, would use actual screen capture)
                setTimeout(() => {
                    screenShareVideo.style.display = 'block';
                    screenShareContainer.querySelector('.video-placeholder').style.display = 'none';
                }, 1000);
            } else {
                stopScreenSharing();
            }
        });
        
        // Stop Screen Sharing Button
        stopScreenShareBtn.addEventListener('click', stopScreenSharing);
        
        function stopScreenSharing() {
            screenShareContainer.style.display = 'none';
            screenShareVideo.style.display = 'none';
            screenShareContainer.querySelector('.video-placeholder').style.display = 'flex';
            screenShareBtn.innerHTML = '<i class="fas fa-share-square me-1"></i> Share Screen';
            isScreenSharing = false;
        }
    </script>
</body>
</html>
